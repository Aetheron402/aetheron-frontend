<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{% block title %}Aetheron{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/static/css/style.css">

  <style>
    body { background-color: #030712; color: #e5e7eb; opacity: 0; transition: opacity .8s ease; }
    .btn { background:#22d3ee; color:#000; font-weight:600; padding:.5rem 1rem; border-radius:.5rem; transition: all .3s; }
    .btn:hover { background:#67e8f9; }
    .modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,.65); display:none; align-items:center; justify-content:center; z-index:50; }
    .modal { background:#0b1220; border:1px solid rgba(56,189,248,.25); border-radius:1rem; width:min(480px, 92vw); padding:1.25rem; }

    .card {
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(56, 189, 248, 0.25);
      border-radius: 1rem;
      padding: 1.5rem;
      transition: transform .25s, box-shadow .25s;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 0 25px rgba(34, 211, 238, 0.25);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 0.35rem 0.9rem;
      border-radius: 9999px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(56, 189, 248, 0.3);
      color: #67e8f9;
      font-size: .75rem;
      text-transform: lowercase;
    }

    .page-shop .shop-modal-bg { z-index: 60; }
    
    /* ===== Mobile modal overflow fix ===== */
    @media (max-width: 768px) {
      .modal {
        max-height: 85vh;
        overflow-y: auto;
      }

      textarea,
      .code-input {
        max-height: 40vh;
        resize: vertical;
      }
    }
  </style>
</head>

<body class="font-sans {% block body_class %}{% endblock %}">

<!-- HEADER -->
<header class="p-6 border-b border-cyan-900/30 flex justify-between items-center relative">

  <!-- LOGO -->
  <h1 onclick="window.location.href='/'"
      class="text-2xl font-bold text-cyan-400 cursor-pointer hover:text-cyan-300 transition">
    Aetheron Components
  </h1>

  <!-- DESKTOP NAV -->
  <nav class="desktop-nav hidden md:flex gap-6 text-sm items-center">
    <a href="https://github.com/Aetheron402" target="_blank" class="text-gray-400 hover:text-cyan-300">GitHub</a>
    <a href="https://x.com/Aetheron402" target="_blank" class="text-gray-400 hover:text-cyan-300">Aetheron on X</a>
    <a href="/learn" class="text-gray-400 hover:text-cyan-300">Learn</a>
    <a href="/roadmap" class="text-gray-400 hover:text-cyan-300">Roadmap</a>
    <a href="/legal" class="text-gray-400 hover:text-cyan-300">Legal</a>
    <a href="/aetheron-token" class="text-gray-400 hover:text-cyan-300">Aetheron Token</a>

    <button id="connect-wallet"
      class="bg-cyan-700 text-white px-3 py-1 rounded hover:bg-cyan-600 text-xs transition">
      Connect Wallet
    </button>
  </nav>

  <!-- MOBILE MENU BUTTON -->
  <button class="mobile-menu-btn md:hidden text-cyan-300 text-3xl" onclick="toggleMobileMenu()">â˜°</button>

  <!-- MOBILE NAV -->
  <nav id="mobile-nav"
     class="hidden flex-col gap-4 bg-[#030712]/95 border-t border-cyan-400/30 p-4 absolute left-0 right-0 top-full z-50 md:hidden">

    <a href="https://github.com/Aetheron402" target="_blank" class="text-gray-300">GitHub</a>
    <a href="https://x.com/Aetheron402" target="_blank" class="text-gray-300">Aetheron on X</a>
    <a href="/learn" class="text-gray-300">Learn</a>
    <a href="/roadmap" class="text-gray-300">Roadmap</a>
    <a href="/legal" class="text-gray-300">Legal</a>
    <a href="/aetheron-token" class="text-gray-300">Aetheron Token</a>

    <button id="mobile-connect-wallet"
      class="bg-cyan-700 text-white px-3 py-2 rounded">
      Connect Wallet
    </button>
  </nav>

</header>

<!-- PAGE CONTENT -->
<main class="p-6">
  {% block content %}{% endblock %}
</main>

<!-- FOOTER -->
<footer class="border-t border-cyan-900/30 mt-12 text-center text-sm text-gray-500 p-6">
  Â© 2025 Aetheron â€” Built on the X402 protocol.
  <div class="space-x-4 mt-2">

    <a href="https://github.com/Aetheron402" target="_blank"
       class="hover:text-cyan-300 transition">
       GitHub
    </a>

    <a href="https://x.com/Aetheron402" target="_blank"
       class="text-gray-400 hover:text-cyan-300 transition">
       Aetheron on X
    </a>

    <a href="/learn" class="hover:text-cyan-300">Learn</a>
    <a href="/roadmap" class="hover:text-cyan-300">Roadmap</a>
    <a href="/legal" class="hover:text-cyan-300">Legal</a>
    <a href="/aetheron-token" class="hover:text-cyan-300">Aetheron Token</a>
  </div>
</footer>


<!-- Wallet Selection Modal -->
<div id="wallet-select-modal" class="modal-bg" style="display:none;">
  <div class="modal text-center">
    <h3 class="text-cyan-300 text-lg font-semibold mb-4">Choose Wallet</h3>

    <!-- Phantom (Solana) â€” ACTIVE -->
    <button id="phantom-btn"
            class="btn mb-3 w-full flex items-center justify-center gap-2">
      Phantom Wallet
    </button>

    <!-- MetaMask (Ethereum) â€” DISABLED / COMING SOON -->
    <button class="btn w-full flex flex-col items-center justify-center gap-0.5
                   bg-gray-800 cursor-not-allowed opacity-60"
            disabled>
      <span>MetaMask</span>
      <span class="text-xs text-gray-400">Coming Q1 2026</span>
    </button>

    <p class="text-xs text-gray-400 mt-4 cursor-pointer hover:underline"
       onclick="document.getElementById('wallet-select-modal').style.display='none'">
       Cancel
    </p>
  </div>
</div>

<!-- WALLET JS -->
<script>
  let currentWallet = "";
  let currentChain  = "";
  window.currentWallet = "";
  const walletBtn = document.getElementById("connect-wallet");

  function shorten(addr) {
    return "ðŸ”— " + addr.slice(0,4) + "..." + addr.slice(-4);
  }

  function updateWalletUI() {
    const mobileWalletBtn = document.getElementById("mobile-connect-wallet");

    if (!currentWallet) {
      walletBtn.textContent = "Connect Wallet";
      if (mobileWalletBtn) mobileWalletBtn.textContent = "Connect Wallet";
      return;
    }

    walletBtn.textContent = shorten(currentWallet);
    if (mobileWalletBtn) mobileWalletBtn.textContent = shorten(currentWallet);
  }

  async function connectPhantom() {
    if (!window.solana?.isPhantom) {
      alert("To continue, please open this site through the Phantom app browser on mobile, or use a desktop browser with the Phantom extension installed.");
      return;
    }

    try {
      await window.solana.disconnect().catch(()=>{});
      const res = await window.solana.connect({ onlyIfTrusted: false });
      currentWallet = res.publicKey.toString();
      currentChain = "solana";

      window.currentWallet = currentWallet;
      
      updateWalletUI();

      window.dispatchEvent(new Event("wallet:connected"));

    } catch(err) {
      console.error(err);
    }

    document.getElementById("wallet-select-modal").style.display = "none";
  }

  async function connectMetamask() {
    if (!window.ethereum) {
      alert("MetaMask not found");
      return;
    }

    try {
      const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
      currentWallet = accounts[0];
      currentChain = "ethereum";
      updateWalletUI();
    } catch(err) {
      console.error(err);
    }

    document.getElementById("wallet-select-modal").style.display = "none";
  }

  walletBtn.addEventListener("click", () => {
    if (!currentWallet) {
      document.getElementById("wallet-select-modal").style.display = "flex";
    } else {
      if (confirm("Disconnect wallet?")) {
        currentWallet = "";
        currentChain = "";

        window.currentWallet = "";
        
        updateWalletUI();
      }
    }
  });

  document.getElementById("phantom-btn").onclick = connectPhantom;

  document.body.style.opacity = 1;
</script>

<script>
  const mobileWalletBtn = document.getElementById("mobile-connect-wallet");

  if (mobileWalletBtn) {
    mobileWalletBtn.addEventListener("click", () => {
      if (!currentWallet) {
        document.getElementById("wallet-select-modal").style.display = "flex";
      } else {
        if (confirm("Disconnect wallet?")) {
          currentWallet = "";
          currentChain = "";
          window.currentWallet = "";
          updateWalletUI();
        }
      }
    });
  }
</script>


<script>
async function registerPayment({ txSig, payMethod }) {
  if (!currentWallet) {
    throw new Error("Wallet not connected");
  }

  return {
    txSig,
    wallet: currentWallet,
    method: payMethod || "USDC"
  };
}
</script>

<script>
function toggleMobileMenu() {
  const nav = document.getElementById("mobile-nav");
  if (!nav) return;
  nav.classList.toggle("hidden");
  nav.classList.toggle("flex");
}
</script>

<script>
async function requestTxSignature() {
  const sig = prompt("Paste your transaction signature:");
  if (!sig) throw new Error("Transaction signature required");
  return sig.trim();
}
</script>

<script>
function forceClosePaymentModal() {
  const modal = document.getElementById("payment-modal");
  if (!modal) return;

  modal.style.display = "none";

  modal.classList.remove("flex");
  document.body.style.pointerEvents = "auto";
}
</script>

<script>
const globalLocks = {};

function lock(key) {
  if (globalLocks[key]) return false;
  globalLocks[key] = true;
  return true;
}

function unlock(key) {
  globalLocks[key] = false;
}

async function safeJson(res) {
  const text = await res.text();
  try {
    return JSON.parse(text);
  } catch {
    return { error: "Invalid JSON response", raw: text.slice(0, 200) };
  }
}
</script>

{% block scripts %}{% endblock %}

</body>
</html>
